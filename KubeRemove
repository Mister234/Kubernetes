sudo kubeadm reset

# Stop service
sudo systemctl stop containerd
sudo systemctl stop kubelet


# Remove all packages related to Kubernetes
sudo apt remove -y kubeadm kubectl kubelet kubernetes-cni containerd.io
sudo apt purge -y kube* containerd.io docker-ce-cli docker-ce docker-engine docker.io containerd runc -y


# Remove parts
sudo apt autoremove -y
sudo rm -rf /etc/kubernetes
sudo apt-get clean

# Remove all folder associated to kubernetes, etcd, and docker
sudo rm -rf ~/.kube
sudo rm -rf /etc/cni /etc/kubernetes /var/lib/dockershim /var/lib/etcd /var/lib/kubelet /var/lib/etcd2/ /var/run/kubernetes ~/.kube/* 
sudo rm -rf /var/lib/containerd /var/lib/docker /etc/containerd /etc/docker


# Clear the iptables
sudo iptables -F && iptables -X
sudo iptables -t nat -F && iptables -t nat -X
sudo iptables -t raw -F && iptables -t raw -X
sudo iptables -t mangle -F && iptables -t mangle -X

# Reset kubeadm, if necessary, on all nodes of the cluster
sudo kubeadm reset -f

# setting up and restarting for containerd
sudo rm -f /etc/containerd/config.toml
containerd config default | sudo tee /etc/containerd/config.toml
sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml
sudo systemctl restart containerd
